<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="./new_file.css">
    <script src="../js/jquery-3.2.1.min.js"></script>
    <!-- 导入模板引擎 -->
    <script src="../模板引擎/template-web.js"></script>
</head>

<body>
    <div class="box">
        <div class="tab-active">宝贝</div>
        <div>店铺</div>
    </div>

    <div class="search-box">
        <input type="text" id="ipt" placeholder="请输入要搜索的内容"><button class="btnSearch">
			搜索</button>
    </div>
    <!-- 模板结构 -->
    <div id="suggest-list">
        <script type="text/html" id="tpl-suggestList">
            {{each result}}
            <div class="suggest-time">{{$value[0]}}</div>
            {{/each}}
        </script>
    </div>


    <script>
        $(function() {
            // 1.定义延时器的ID
            var timer = null
			// 定义全局缓存对象
			var cacheObj = {}

            // 2.定义防抖的函数
            function debounceSearch(kw) {
                timer = setTimeout(function() {
                    getSuggestList(kw)
                }, 500)
            }

            $('#ipt').on('keyup', function() {
                //3.清空 timer
                clearTimeout(timer)
                var keywords = $(this).val().trim()
                if (keywords.length <= 0) {
                    return $('#suggest-list').empty().hide()
                }
				
				// 先判断缓存中是否有数据
				if (cacheObj[keywords]) {
					return renderSuggestList(cacheObj[keywords])
				}

                // TODO 获取搜索建议列表 调用函数getSuggestList
                // console.log(keywords);
                //getSuggestList(keywords)
				debounceSearch(keywords)
            })

            function getSuggestList(kw) {
                $.ajax({
                    // q 是用户输入的关键字
                    url: 'https://suggest.taobao.com/sug?q=' + kw,
                    dataType: 'jsonp',
                    success: function(res) {
                        //console.log(res);
                        renderSuggestList(res)
                    }
                })
            }

            //渲染UI结构
            function renderSuggestList(res) {
                if (res.result.length <= 0) {
                    return $('#suggest-list').empty().hide()
                }
                var htmlStr = template('tpl-suggestList', res)
                $('#suggest-list').html(htmlStr).show()
				
				//1.获取用户输入的内容，当做键
				var k = $('#ipt').val().trim()
				// 将数据作为值，进行缓存
				cacheObj[k] = res
            }

        })
    </script>
</body>


</html>